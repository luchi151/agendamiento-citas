{% extends 'citas/base_citas.html' %}

{% block title %}Cancelar Cita - ATENEA{% endblock %}

{% block page_title %}Selecciona la Cita a Cancelar{% endblock %}

{% block extra_css %}
<style>
    .form-container {
        max-width: 900px;
    }
    
    .cita-card {
        background: #f8f9fa;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        padding: 25px;
        margin-bottom: 20px;
        transition: all 0.3s;
    }
    
    .cita-card:hover {
        border-color: #0d47a1;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .cita-card.no-cancelable {
        opacity: 0.6;
        background: #fafafa;
    }
    
    .cita-info {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }
    
    .cita-info i {
        color: #0d47a1;
        font-size: 1.2rem;
        margin-right: 10px;
        width: 25px;
    }
    
    .cita-info strong {
        color: #212121;
        margin-right: 5px;
    }
    
    .alert-no-cancelable {
        background: #ffebee;
        border-left: 4px solid #d32f2f;
        padding: 10px 15px;
        border-radius: 5px;
        margin-top: 10px;
        font-size: 0.9rem;
    }
    
    .no-citas-message {
        text-align: center;
        padding: 40px;
        color: #757575;
    }
    
    .no-citas-message i {
        font-size: 4rem;
        color: #bdbdbd;
        margin-bottom: 20px;
    }
</style>
{% endblock %}

{% block content %}
<div class="form-container">
    <h2 class="section-title">
        <i class="bi bi-calendar-x"></i> Selecciona la Cita a Cancelar
    </h2>
    
    {% if messages %}
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        {% endfor %}
    {% endif %}
    
    {% if citas %}
        {% for cita in citas %}
        <div class="cita-card {% if not cita.puede_cancelarse %}no-cancelable{% endif %}">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <div class="cita-info">
                        <i class="bi bi-calendar-event"></i>
                        <div>
                            <strong>Fecha:</strong> {{ cita.fecha|date:"l, d \d\e F \d\e Y" }}
                        </div>
                    </div>
                    
                    <div class="cita-info">
                        <i class="bi bi-clock"></i>
                        <div>
                            <strong>Hora:</strong> {{ cita.hora_inicio|time:"h:i A" }} - {{ cita.hora_fin|time:"h:i A" }}
                        </div>
                    </div>
                    
                    <div class="cita-info">
                        <i class="bi bi-check-circle"></i>
                        <div>
                            <strong>Estado:</strong> 
                            <span class="badge bg-success">{{ cita.get_estado_display }}</span>
                        </div>
                    </div>
                    
                    {% if not cita.puede_cancelarse %}
                    <div class="alert-no-cancelable">
                        <i class="bi bi-exclamation-circle"></i>
                        <strong>No se puede cancelar:</strong> Esta cita está a menos de 2 horas de iniciar o ya pasó.
                    </div>
                    {% endif %}
                </div>
                
                <div class="col-md-4 text-end">
                    {% if cita.puede_cancelarse %}
                    <form method="post" action="{% url 'citas:cancelar_cita' cita.id %}" style="display: inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-cancelar-cita" 
                                onclick="return confirm('¿Estás seguro de que deseas cancelar esta cita?\n\nFecha: {{ cita.fecha|date:"d/m/Y" }}\nHora: {{ cita.hora_inicio|time:"h:i A" }}');">
                            <i class="bi bi-x-circle"></i> Cancelar Cita
                        </button>
                    </form>
                    {% else %}
                    <button type="button" class="btn btn-cancelar-cita" disabled>
                        <i class="bi bi-x-circle"></i> No Cancelable
                    </button>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="no-citas-message">
            <i class="bi bi-calendar-x"></i>
            <h4>No tienes citas agendadas</h4>
            <p class="text-muted">No encontramos citas agendadas con los datos proporcionados.</p>
            <a href="{% url 'citas:agendar_cita' %}" class="btn btn-siguiente mt-3">
                <i class="bi bi-plus-circle"></i> Agendar Nueva Cita
            </a>
        </div>
    {% endif %}
    
    <div class="text-center mt-4">
        <a href="{% url 'home' %}" class="btn btn-volver">
            <i class="bi bi-arrow-left"></i> Volver al Inicio
        </a>
    </div>
</div>
{% endblock %}